<html>
	<head>
		<style>
			#myCanvas{
				margin:0 auto;
				display:block;
				position:absolute;
			}
			#form{
				position: absolute;
			}
			.student{
				background:gray;
				display:block;
				position:absolute;
				width:80px;
				height:40px;
				z-index:10;
				cursor:pointer;
			}
			.absent{
				background:blue;
			}
			.late{
				background: pink;
			}
			.studentName{
				position:relative;
				z-index:-1;
				cursor:pointer;
			}
			
			.unselectable {
				-webkit-touch-callout: none;
				-webkit-user-select: none;
				-khtml-user-select: none;
				-moz-user-select: none;
				-ms-user-select: none;
				user-select: none;
			}
			.classInfo{
				display:inline-block;
				margin-right:40px
			}
			#postCanvas{
				margin-top:625px;
			}
		</style>
	</head>
	<body>
		<header>
		</header>
		
		<div id="main">
			<section>
				<span>Class Code:</span>
				<p id = "classCode" class = "classInfo"></p>
				<span>Room:</span>
				<p id = "room" class = "classInfo"></p>
				<span>Schedule:</span>
				<p id = "sched" class = "classInfo"></p>
				<span>Number of Students:</span>
				<p id = "numOfStud" class = "classInfo"></p>
				<span>Instructor:</span>
				<p id = "instructor" class = "classInfo"></p>
			</section>
			<canvas id="myCanvas" width="1000" height="600" style="border:1px solid #000000;">
			</canvas>
			
		</div>
		<section id = "postCanvas">
				<button onclick = endClass()>End Class</button>
		</section>
		
		<footer>
		</footer>
		
	</body>
	<script type="text/javascript" src="scripts/checkAttendance.js"></script>
	<script>
		//for sample getting of data from localStorage
		var id = 0;
		var array = [];
		var students = [new Student( ++id,"last_name", 
			"first_name", "middle_initial", "15", "15" ,"enrolled", "belthazod",  array), 
			new Student(++id,"last_name", 
			"first_name", "middle_initial", "105", "15" ,"enrolled", "belthazod",  array),
			new Student(++id,"last_name", 
			"first_name", "middle_initial", "195", "15" ,"enrolled", "belthazod",  array),
			new Student(++id,"last_name", 
			"first_name", "middle_initial", "285", "15" ,"enrolled", "belthazod",  array),
			new Student(++id,"last_name", 
			"first_name", "middle_initial", "375", "15" ,"enrolled", "belthazod",  array),
			new Student(++id,"last_name", 
			"first_name", "middle_initial", "15", "95" ,"enrolled", "belthazod",  array),
			new Student(++id,"last_name", 
			"first_name", "middle_initial", "105", "95" ,"enrolled", "belthazod",  array),
			new Student(++id,"last_name", 
			"first_name", "middle_initial", "195", "95" ,"enrolled", "belthazod",  array),
			new Student(++id,"last_name", 
			"first_name", "middle_initial", "285", "95" ,"enrolled", "belthazod",  array),
			new Student(++id,"last_name", 
			"first_name", "middle_initial", "375", "95" ,"enrolled", "belthazod",  array),
			new Student(++id,"last_name", 
			"first_name", "middle_initial", "15", "175" ,"enrolled", "belthazod",  array),
			new Student(++id,"last_name", 
			"first_name", "middle_initial", "105", "175" ,"enrolled", "belthazod",  array),
			new Student(++id,"last_name", 
			"first_name", "middle_initial", "195", "175" ,"enrolled", "belthazod",  array),
			new Student(++id,"last_name", 
			"first_name", "middle_initial", "285", "175" ,"enrolled", "belthazod",  array),
			new Student(++id,"last_name", 
			"first_name", "middle_initial", "375", "175" ,"enrolled", "belthazod",  array),
			new Student(++id,"last_name", 
			"first_name", "middle_initial", "15", "255" ,"enrolled", "belthazod",  array),
			new Student(++id,"last_name", 
			"first_name", "middle_initial", "105", "255" ,"enrolled", "belthazod",  array),
			new Student(++id,"last_name", 
			"first_name", "middle_initial", "195", "255" ,"enrolled", "belthazod",  array),
			new Student(++id,"last_name", 
			"first_name", "middle_initial", "285", "255" ,"enrolled", "belthazod",  array),
			new Student(++id,"last_name", 
			"first_name", "middle_initial", "375", "255" ,"enrolled", "belthazod",  array),
			new Student(++id,"last_name", 
			"first_name", "middle_initial", "15", "335" ,"enrolled", "belthazod",  array),
			new Student(++id,"last_name", 
			"first_name", "middle_initial", "105", "335" ,"enrolled", "belthazod",  array),
			new Student(++id,"last_name", 
			"first_name", "middle_initial", "195", "335" ,"enrolled", "belthazod",  array),
			new Student(++id,"last_name", 
			"first_name", "middle_initial", "285", "335" ,"enrolled", "belthazod",  array),
			new Student(++id,"last_name", 
			"first_name", "middle_initial", "375", "335" ,"enrolled", "belthazod",  array),
			new Student(++id,"last_name", 
			"first_name", "middle_initial", "910", "15" ,"enrolled", "belthazod",  array),
			new Student(++id,"last_name", 
			"first_name", "middle_initial", "820", "15" ,"enrolled", "belthazod",  array),
			new Student(++id,"last_name", 
			"first_name", "middle_initial", "730", "15" ,"enrolled", "belthazod",  array),
			new Student(++id,"last_name", 
			"first_name", "middle_initial", "640", "15" ,"enrolled", "belthazod",  array),
			new Student(++id,"last_name", 
			"first_name", "middle_initial", "550", "15" ,"enrolled", "belthazod",  array),
			new Student(++id,"last_name", 
			"first_name", "middle_initial", "910", "95" ,"enrolled", "belthazod",  array),
			new Student(++id,"last_name", 
			"first_name", "middle_initial", "820", "95" ,"enrolled", "belthazod",  array),
			new Student(++id,"last_name", 
			"first_name", "middle_initial", "730", "95" ,"enrolled", "belthazod",  array),
			new Student(++id,"last_name", 
			"first_name", "middle_initial", "640", "95" ,"enrolled", "belthazod",  array),
			new Student(++id,"last_name", 
			"first_name", "middle_initial", "550", "95" ,"enrolled", "belthazod",  array),
			new Student(++id,"last_name", 
			"first_name", "middle_initial", "910", "175" ,"enrolled", "belthazod",  array),
			new Student(++id,"last_name", 
			"first_name", "middle_initial", "820", "175" ,"enrolled", "belthazod",  array),
			new Student(++id,"last_name", 
			"first_name", "middle_initial", "730", "175" ,"enrolled", "belthazod",  array),
			new Student(++id,"last_name", 
			"first_name", "middle_initial", "640", "175" ,"enrolled", "belthazod",  array),
			new Student(++id,"last_name", 
			"first_name", "middle_initial", "550", "175" ,"enrolled", "belthazod",  array),
			new Student(++id,"last_name", 
			"first_name", "middle_initial", "910", "255" ,"enrolled", "belthazod",  array),
			new Student(++id,"last_name", 
			"first_name", "middle_initial", "820", "255" ,"enrolled", "belthazod",  array),
			new Student(++id,"last_name", 
			"first_name", "middle_initial", "730", "255" ,"enrolled", "belthazod",  array),
			new Student(++id,"last_name", 
			"first_name", "middle_initial", "640", "255" ,"enrolled", "belthazod",  array),
			new Student(++id,"last_name", 
			"first_name", "middle_initial", "550", "255" ,"enrolled", "belthazod",  array),
			new Student(++id,"last_name", 
			"first_name", "middle_initial", "910", "335" ,"enrolled", "belthazod",  array),
			new Student(++id,"last_name", 
			"first_name", "middle_initial", "820", "335" ,"enrolled", "belthazod",  array),
			new Student(++id,"last_name", 
			"first_name", "middle_initial", "730", "335" ,"enrolled", "belthazod",  array),
			new Student(++id,"last_name", 
			"first_name", "middle_initial", "640", "335" ,"enrolled", "belthazod",  array),
			new Student(++id,"last_name", 
			"first_name", "middle_initial", "550", "335" ,"enrolled", "belthazod",  array),];
			
		var x = new universityClass(7006, "s421", "8:30-9:30", 50, "belthazod", students);
		
		localStorage.setItem("students", JSON.stringify(x));
		
		
		//Gets object from localStorage
		var p = JSON.parse(localStorage.getItem('students'));
		
		document.getElementById('classCode').innerHTML = p.classcode;
		document.getElementById('room').innerHTML = p.room;
		document.getElementById('sched').innerHTML = p.sched;
		document.getElementById('numOfStud').innerHTML = p.numOfStud;
		document.getElementById('instructor').innerHTML = p.username;
		
		var c = document.getElementById("myCanvas");
		var ctx = c.getContext("2d");
		var main = document.getElementById('main');
		
		/*var seats = 0;
		var y = 15;
		var row = 1;
		var main = document.getElementById('main');
		var seatCount = 0;
		for(var x = 15 ; row<6; x+=90){
			if(seats > 4){
				y+= 80;
				seats = 0;
				x = 15;
				row++;
			}
			if (row<6){
				seatCount++;
				var div = document.createElement("div");
				div.setAttribute("style", "margin-top:" + (y+1) + ";margin-left:" + (x+1));
				div.className="student unselectable";
				div.setAttribute("onclick", "changeState("+seatCount+")");
				div.innerHTML = "student";
				main.appendChild(div);
			
				ctx.fillStyle = "#FF0000";
				ctx.fillRect(x, y, 80, 40);
				seats++;
			}
		}
		var seats = 0;
		var row = 1;
		var y = 15;
		
		for(var x = 910 ; row<6; x-=90){
			if(seats > 4){
				y += 80;
				seats = 0;
				x = 910;
				row++;
			}
			if (row<6){
				seatCount++;
				var div = document.createElement("div");
				div.setAttribute("style", "margin-top:" + (y+1) + ";margin-left:" + (x+1));
				div.className="student unselectable";
				div.setAttribute("onclick", "changeState("+seatCount+")");
				div.innerHTML = "student";
				main.appendChild(div);
				
				ctx.fillStyle = "#FF0000";
				ctx.fillRect(x, y, 80, 40);
				seats++;
			}
		}*/
		seatCount = 0;
		for(var i = 0; i< p.students.length; i++){
				seatCount++;
				var div = document.createElement("div");
				div.setAttribute("style", "margin-top:" + (parseInt(p.students[i].y_coordinate)+1) + ";margin-left:" + (parseInt(p.students[i].x_coordinate)+1));
				div.className="student unselectable";
				div.setAttribute("onclick", "changeState("+seatCount+")");
				div.innerHTML = "student";
				div.title =  p.students[i].stud_id;
				main.appendChild(div);
			
				ctx.fillStyle = "#FF0000";
				ctx.fillRect(p.students[i].x_coordinate, p.students[i].y_coordinate, 80, 40);
		}
		
		function changeState(index){
			var main = document.getElementById('main');
			var selectedStudent = main.getElementsByClassName('student')[index-1];
			if(selectedStudent.className == "student unselectable"){
				selectedStudent.className = "student absent unselectable";
			}else if(selectedStudent.className == "student absent unselectable"){
				selectedStudent.className = "student late unselectable";
			}else{
				selectedStudent.className = "student unselectable";
			}
		}
		
		function endClass(){
			var main = document.getElementById('main');
			
			var absentStudents = main.getElementsByClassName('absent');
			alert(absentStudents);
			var absentStudentsList = [];
			for(var i = 0; i < absentStudents.length; i++){
				absentStudentsList.push(absentStudents[i].title);
			}
			for(var index = 0; index < absentStudentsList.length; index++){
				var studentID = absentStudentsList.pop();
				for(var x = 0; x<p.students.length; x++){
					
					if(studentID == p.students[x].stud_id){
						p.students[x].records.push(new Record("10,10,2014","absent"));
						break;
					}
				}
			}
			
			var lateStudents = main.getElementsByClassName('late');
			alert("Late students" + lateStudents);
			var lateStudentsList = [];
			for(var i = 0; i < lateStudents.length; i++){
				lateStudentsList.push(lateStudents[i].title);
			}
			for(var index = 0; index < lateStudentsList.length; index++){
				var studentID = lateStudentsList.pop();
				for(var i = 0; i < p.students.length; i++){
					
					if(studentID == p.students[i].stud_id){
						p.students[i].records.push(new Record("10,10,2014","tardy"));
						break;
					}
				}
			}
			var classCode = document.getElementById("classCode").innerHTML;
			localStorage.setItem(classCode, JSON.stringify(p));
		}
		
	</script>
	
</html>